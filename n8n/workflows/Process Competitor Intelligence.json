{
  "name": "Process Competitor Intelligence",
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "runId"
            },
            {
              "name": "brandId"
            },
            {
              "name": "brandName"
            },
            {
              "name": "visibilityScore"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -112,
        288
      ],
      "id": "b5e1d7ef-f1a4-4077-856d-8e05ecfd41d0",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "config-run-id",
              "name": "runId",
              "type": "string",
              "value": "={{ $('When Executed by Another Workflow').first().json.runId }}"
            },
            {
              "id": "config-brand-id",
              "name": "brandId",
              "type": "string",
              "value": "={{ $('When Executed by Another Workflow').first().json.brandId }}"
            },
            {
              "id": "config-brand-name",
              "name": "brandName",
              "type": "string",
              "value": "={{ $('When Executed by Another Workflow').first().json.brandName }}"
            },
            {
              "id": "config-visibility-score",
              "name": "visibilityScore",
              "type": "number",
              "value": "={{ $('When Executed by Another Workflow').first().json.visibilityScore }}"
            }
          ]
        },
        "options": {}
      },
      "id": "3f371fee-006a-451c-ba06-af539823e933",
      "name": "Config",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        112,
        288
      ]
    },
    {
      "parameters": {
        "jsCode": "// Simple placeholder implementation for competitor identification\n// Returns 3 generic competitors with scores\n\nreturn [\n  { json: { name: 'Competitor A', score: 80, gap: 'Competitor A has higher visibility in search results.' } },\n  { json: { name: 'Competitor B', score: 75, gap: 'Competitor B has stronger brand recognition.' } },\n  { json: { name: 'Competitor C', score: 70, gap: 'Competitor C has better content strategy.' } }\n];"
      },
      "id": "6c81025a-b9b7-4f9c-bc7b-85b26d1474c9",
      "name": "Generate Competitors",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        304,
        288
      ]
    },
    {
      "parameters": {
        "jsCode": "// Collect all competitors and format as flat fields\nconst competitors = $input.all().map(item => item.json);\n\nreturn [{\n  json: {\n    competitor_1_name: competitors[0]?.name || null,\n    competitor_1_score: competitors[0]?.score || null,\n    competitor_1_gap: competitors[0]?.gap || null,\n    competitor_2_name: competitors[1]?.name || null,\n    competitor_2_score: competitors[1]?.score || null,\n    competitor_2_gap: competitors[1]?.gap || null,\n    competitor_3_name: competitors[2]?.name || null,\n    competitor_3_score: competitors[2]?.score || null,\n    competitor_3_gap: competitors[2]?.gap || null\n  }\n}];"
      },
      "id": "4cd874f2-8770-4346-a28e-4697d4cdb8ea",
      "name": "Format Competitor Fields",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        512,
        288
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "analysis_runs",
        "filterType": "string",
        "filterString": "=run_id=eq.{{ $('Config').first().json.runId }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "competitor_1_name",
              "fieldValue": "={{ $json.competitor_1_name }}"
            },
            {
              "fieldId": "competitor_1_score",
              "fieldValue": "={{ $json.competitor_1_score }}"
            },
            {
              "fieldId": "competitor_1_gap",
              "fieldValue": "={{ $json.competitor_1_gap }}"
            },
            {
              "fieldId": "competitor_2_name",
              "fieldValue": "={{ $json.competitor_2_name }}"
            },
            {
              "fieldId": "competitor_2_score",
              "fieldValue": "={{ $json.competitor_2_score }}"
            },
            {
              "fieldId": "competitor_2_gap",
              "fieldValue": "={{ $json.competitor_2_gap }}"
            },
            {
              "fieldId": "competitor_3_name",
              "fieldValue": "={{ $json.competitor_3_name }}"
            },
            {
              "fieldId": "competitor_3_score",
              "fieldValue": "={{ $json.competitor_3_score }}"
            },
            {
              "fieldId": "competitor_3_gap",
              "fieldValue": "={{ $json.competitor_3_gap }}"
            }
          ]
        }
      },
      "id": "ed3e50da-ceba-4e3d-8dae-3be5c6a91708",
      "name": "Update Competitor Data",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        704,
        288
      ],
      "credentials": {
        "supabaseApi": {
          "id": "xjyTBcrvj3X5rWEu",
          "name": "Supabase account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Config": {
      "main": [
        [
          {
            "node": "Generate Competitors",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Competitors": {
      "main": [
        [
          {
            "node": "Format Competitor Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Competitor Fields": {
      "main": [
        [
          {
            "node": "Update Competitor Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f415fdd4-71ce-457e-a538-2766f28be8c8",
  "meta": {
    "instanceId": "02bba7aac379f6e7cacf7ad50786592b16e7ca5dbfbf71b3b9646d979cc00f6e"
  },
  "id": "ZjdYn2YtHbYvfWs6",
  "tags": []
}